{% extends 'main/layout/base.html' %}
{% load static %}

{% block title %}Select Payment Method{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'styles/payment.css' %}">

<section class="payment-section">
  <div class="container-xl">
    <h2 class="payment-heading">Select Payment Method</h2>
    <hr class="payment-divider">

    <div class="payment-grid">
      <form method="POST" class="payment-form" action="{% url 'main:payment' %}">
        {% csrf_token %}

        <div class="payment-card">
          <label class="radio-option">
            <input type="radio" name="payment_method" value="card" checked>
            <div>
              <span>Credit/Debit Cards</span>
              <p>Pay with your Credit / Debit Card</p>
            </div>
            <img src="{% static 'images/cards.png' %}" class="card-img" alt="Credit/Debit Cards" class="payment-icons card-logos">
          </label>

          <div class="card-details">
            <div class="form-group">
              <div class="input-with-icon">
                <input type="text" id="card-number" name="card_number" placeholder="Card Number" required>
                <i class="bi bi-credit-card"></i> </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                
                <div class="input-with-icon">
                  <input type="text" id="expiry" name="expiry" placeholder="MM / YY" required>
                  <i class="bi bi-calendar"></i> </div>
              </div>
              <div class="form-group">
               
                <div class="input-with-icon">
                  <input type="text" id="cvv" name="cvv" placeholder="CVV" required>
                  <i class="bi bi-lock-fill"></i> </div>
              </div>
            </div>

            </div>
        </div>

        <div class="payment-option">
          <label class="radio-option">
            <input type="radio" name="payment_method" value="bank_transfer">
            <div>
              <span>Direct Bank Transfer</span>
              <p>Make payment directly through bank account.</p>
            </div>
            </label>
        </div>

        <div class="payment-option">
          <label class="radio-option">
            <input type="radio" name="payment_method" value="other">
            <div>
              <span>Other Payment Methods</span>
              <p>Make payment through Gpay, Paypal, Phonepay etc</p>
            </div>
            <img src="{% static 'images/upi.png' %}" alt="UPI/Paypal/Phonepay" class="payment-icons">
          </label>
        </div>

        <div class="payment-buttons">
          <a href="{% url 'main:checkout' %}" class="back-btn">Back</a>
          <button type="submit" class="pay-btn" onclick="showLoader(event)">Pay Securely</button>
        </div>
      </form>

      <div class="summary-card">
  <h3>Order Summary <span>{{ cart_items.count }} Items</span></h3>
  <div class="order-items">
    {% for item in cart_items %}
    <div class="order-item">
      <p>{{ item.template.name }}</p>
      <span>${{ item.template.price|floatformat:2 }}</span>
    </div>
    {% endfor %}
  </div>

<div class="order-totals">
  <p class="discount">Total discount <span>${{ discount|floatformat:2 }}</span></p>
  <p class="fee">Handling Fee <span>$0.00</span></p>
  <h4 class="total-line">Total <span>US$ {{ grand_total|floatformat:2 }}</span></h4>

  <div class="secure-checkout">
    <i class="bi bi-lock-fill lock"></i>
    <span>Secure Checkout</span>
  </div>
</div>
    </div>
  </div>
</section>

<script>
  function showLoader(event) {
    event.preventDefault(); // Prevent default form submission
    const form = document.querySelector('.payment-form');

    // Basic Form Validation (only for the checked radio button's fields)
    const selectedMethod = document.querySelector('input[name="payment_method"]:checked').value;

    let isValid = true;
    if (selectedMethod === 'card') {
      const cardNumber = document.getElementById('card-number').value;
      const expiry = document.getElementById('expiry').value;
      const cvv = document.getElementById('cvv').value;

      if (!cardNumber || !expiry || !cvv) {
        isValid = false;
        alert('Please fill in all card details.'); // Simple alert for missing fields
      }
      // Add more rigorous validation here if needed (e.g., regex for card number, expiry format)
    }

    if (!isValid) {
      return; // Stop if validation fails
    }

    form.submit();

  }
</script>
{% endblock %}